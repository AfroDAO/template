var Tiles={};!function(a){var b=Tiles.Tile=function(d,c){this.id=d,this.top=0,this.left=0,this.width=0,this.height=0,this.$el=a(c||document.createElement("div"))};b.prototype.appendTo=function(d,g,c,f){this.$el.hide().appendTo(d),g?this.$el.delay(c).fadeIn(f):this.$el.show()},b.prototype.remove=function(d,c){d?this.$el.fadeOut({complete:function(){a(this).remove()}}):this.$el.remove()},b.prototype.resize=function(p,m,j,q,k){var g={},f=!1;this.left!==m.x&&(g.left=m.x,this.left=m.x,f=!0),this.top!==m.y&&(g.top=m.y,this.top=m.y,f=!0),this.width!==m.width&&(g.width=m.width,this.width=m.width,f=!0),this.height!==m.height&&(g.height=m.height,this.height=m.height,f=!0);var d=this,c=function(){var e=d.$el[0];d.left!==e.offsetLeft&&d.$el.css("left",d.left),d.top!==e.offsetTop&&d.$el.css("top",d.top),k&&k()};j&&f?this.$el.animate(g,{duration:q,easing:"swing",complete:c}):(f&&this.$el.css(g),setTimeout(c,q))}}(jQuery),function(b){function d(g,j,f,h){this.x=g,this.y=j,this.width=f,this.height=h}var a=function(j){var p,g,m,k,f,r=[],q=j.length;for(g=0;q>g;g++){for(m=j[g],r[g]=[],p=0,k=m.length;k>p;p++){f=m[p]," "!==f&&r[g].push(f)}}return r};d.prototype.copy=function(){return new d(this.x,this.y,this.width,this.height)},Tiles.Rectangle=d;var c=function(x){var m,y,q,k,j,g,e,v=[],f=x.length,w=0===f?0:x[0].length;for(x=x.slice(),j=0;f>j;j++){x[j]=x[j].slice()}for(j=0;f>j;j++){for(k=0;w>k;k++){if(m=x[j][k],null!=m){if(q=1,y=1,m!==Tiles.Template.SINGLE_CELL){for(;w>q+k&&m===x[j][k+q];){q++}for(;f>y+j&&m===x[j+y][k];){y++}}for(e=0;y>e;e++){for(g=0;q>g;g++){x[j+e][k+g]=null}}v.push(new d(k,j,q,y))}}}return v};Tiles.Template=function(g,h,f){this.rects=g,this.numTiles=this.rects.length,this.numRows=f,this.numCols=h},Tiles.Template.prototype.copy=function(){var g,h,f=[];for(h=0,g=this.rects.length;g>h;h++){f.push(this.rects[h].copy())}return new Tiles.Template(f,this.numCols,this.numRows)},Tiles.Template.prototype.append=function(g){if(this.numCols!==g.numCols){throw"Appended templates must have the same number of columns"}var f,k,j,e=this.numRows;for(f=0,k=g.rects.length;k>f;f++){j=g.rects[f],this.rects.push(new d(j.x,e+j.y,j.width,j.height))}this.numRows+=g.numRows,this.numTiles+=g.numTiles},Tiles.Template.fromJSON=function(f){var i=a(f),g=c(i);return new Tiles.Template(g,i.length>0?i[0].length:0,i.length)},Tiles.Template.prototype.toJSON=function(){var v,q,m,w,p,k,j="ABCDEFGHIJKLMNOPQRSTUVWXYZ",g=j.length,f=0,u=[];for(p=0;p<this.numRows;p++){for(u[p]=[],w=0;w<this.numCols;w++){u[p][w]=Tiles.Template.SINGLE_CELL}}for(v=0,q=this.rects.length;q>v;v++){if(m=this.rects[v],m.width>1||m.height>1){for(k=j[f],p=0;p<m.height;p++){for(w=0;w<m.width;w++){u[m.y+p][m.x+w]=k}}f=(f+1)%g}}for(p=0;p<this.numRows;p++){u[p]=u[p].join("")}return u},Tiles.Template.SINGLE_CELL="."}(jQuery),Tiles.UniformTemplates={get:function(c,g){var b,f,d=Math.ceil(g/c),a=[];for(f=0;d>f;f++){for(b=0;c>b;b++){a.push(new Tiles.Rectangle(b,f,1,1))}}return new Tiles.Template(a,c,d)}},function(b){function d(m){var g,k,j=[],f=m?m.length:0;for(g=0;f>g;g++){k=m[g],-1===b.inArray(k,j)&&j.push(k)}return j}function a(g,l,f){var k=g.y+g.height,j=g.x+g.width;return l&&!(l.top>k||l.top+l.height<g.y||l.left>j||l.left+l.width<g.x)?!0:f&&!(f.y>k||f.y+f.height<g.y||f.x>j||f.x+f.width<g.x)?!0:!1}var c=Tiles.Grid=function(f){this.$el=b(f),this.animationDuration=300,this.cellSizeMin=150,this.templateFactory=Tiles.UniformTemplates,this.priorityPageSize=Number.MAX_VALUE,this.cellPadding=10,this.cellSize=0,this.numCols=1,this.template=null,this.isDirty=!0,this.tiles=[],this.tilesAdded=[],this.tilesRemoved=[]};c.prototype.getContentWidth=function(){return this.$el.width()},c.prototype.resizeColumns=function(){var e=this.getContentWidth();return Math.max(1,Math.floor((e+this.cellPadding)/(this.cellSizeMin+this.cellPadding)))},c.prototype.resizeCellSize=function(){var e=this.getContentWidth();return Math.ceil((e+this.cellPadding)/this.numCols)-this.cellPadding},c.prototype.resize=function(){var f=this.resizeColumns();this.numCols!==f&&f>0&&(this.numCols=f,this.isDirty=!0);var g=this.resizeCellSize();this.cellSize!==g&&g>0&&(this.cellSize=g,this.isDirty=!0)},c.prototype.updateTiles=function(f){f=d(f);var j,g,e,p,m=f.length,k=[];for(j=this.tiles.length-1;j>=0;j--){g=this.tiles[j],p=b.inArray(g.id,f),0>p?this.tilesRemoved.push(g):k[p]=g}for(this.tiles=[],j=0;m>j;j++){if(g=k[j],!g){if(e=f[j],this.createTile){if(g=this.createTile(e),!g){continue}}else{g=new Tiles.Tile(e)}this.tilesAdded.push(g)}this.tiles.push(g)}},c.prototype.insertTiles=function(e){this.addTiles(e,!0)},c.prototype.addTiles=function(j,n){if(j&&0!==j.length){var g,m=[],k=this.tiles.length;for(g=0;k>g;g++){m.push(this.tiles[g].id)}var f=n?j.concat(m):m.concat(j);this.updateTiles(f)}},c.prototype.removeTiles=function(m){if(m&&0!==m.length){var g,k,j,f=[];for(g=0,k=this.tiles.length;k>g;g++){j=this.tiles[g].id,-1===b.inArray(j,m)&&f.push(j)}this.updateTiles(f)}},c.prototype.createTemplate=function(g,h){g=Math.max(1,g);var f=this.templateFactory.get(g,h);return f||(f=Tiles.UniformTemplates.get(g,h)),f},c.prototype.ensureTemplate=function(f){if(this.template&&this.template.numCols===this.numCols){var g=f-this.template.rects.length;g>0&&(this.template.append(this.createTemplate(this.numCols,g)),this.isDirty=!0)}else{this.template=this.createTemplate(this.numCols,f),this.isDirty=!0}},c.prototype.shouldRedraw=function(){this.cellSize<=0&&this.resize(),this.ensureTemplate(this.tiles.length);var e=this.isDirty||this.tilesAdded.length>0||this.tilesRemoved.length>0;return e},c.prototype.redraw=function(M,A,J){if(!this.shouldRedraw()){return void (A&&A(!1,J))}var I,G,F,D,P,E,x,O,L,N,H,K=this.tiles.length,i=this.priorityPageSize,k=this.animationDuration,t=this.cellSize+this.cellPadding,q=0,B=0,j=new Tiles.Rectangle(this.$el.scrollLeft(),this.$el.scrollTop(),this.$el.width(),this.$el.height());for(q=0;K>q;q+=i){for(F=this.template.rects.slice(q,q+i),D=this.tiles.slice(q,q+i),N=F.slice(0),H=D.slice(0),this.prioritizePage&&this.prioritizePage(N,H),P=0,E=H.length;E>P;P++){I=H[P],G=b.inArray(I,this.tilesAdded)>=0,x=N[P],O=new Tiles.Rectangle(x.x*t,x.y*t,x.width*t-this.cellPadding,x.height*t-this.cellPadding),I.resize(x,O,M&&!G&&a(j,I,O),k),G&&(L=M&&a(j,null,O),B=L&&this.getAppendDelay?this.getAppendDelay(x,F,N,I,D,H):0,I.appendTo(this.$el,L,B,k))}}for(P=0,E=this.tilesRemoved.length;E>P;P++){I=this.tilesRemoved[P],L=M&&a(j,I,null),I.remove(L,k)}this.tilesRemoved=[],this.tilesAdded=[],this.isDirty=!1,A&&setTimeout(function(){A(!0,J)},k+10)}}(jQuery);