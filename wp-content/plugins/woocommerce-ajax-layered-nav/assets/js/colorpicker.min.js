!function(n){var t,e,i,r,a,c,l,d,s,p,o,u,h,f,v,m,g,k,b,_=(e={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!(t=65)},i=function(e){var o,t=n(this).parent().parent();0<this.parentNode.className.indexOf("_hex")?t.data("colorpicker").color=o=m(v(this.value)):0<this.parentNode.className.indexOf("_hsb")?t.data("colorpicker").color=o=h({h:parseInt(t.data("colorpicker").fields.eq(4).val(),10),s:parseInt(t.data("colorpicker").fields.eq(5).val(),10),b:parseInt(t.data("colorpicker").fields.eq(6).val(),10)}):t.data("colorpicker").color=o=g(f({r:parseInt(t.data("colorpicker").fields.eq(1).val(),10),g:parseInt(t.data("colorpicker").fields.eq(2).val(),10),b:parseInt(t.data("colorpicker").fields.eq(3).val(),10)})),e&&(x(o,t.get(0)),y(o,t.get(0)),w(o,t.get(0))),C(o,t.get(0)),M(o,t.get(0)),q(o,t.get(0)),t.data("colorpicker").onChange.apply(t,[o,b(o),k(o)])},r=function(e){return e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10)))),e.data.preview&&i.apply(e.data.field.get(0),[!0]),!1},a=function(e){return i.apply(e.data.field.get(0),[!0]),e.data.el.removeClass("colorpicker_slider").find("input").focus(),n(document).unbind("mouseup",a),n(document).unbind("mousemove",r),!1},c=function(e){return i.apply(e.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,e.pageY-e.data.y)))/150,10)).get(0),[e.data.preview]),!1},l=function(e){return x(e.data.cal.data("colorpicker").color,e.data.cal.get(0)),y(e.data.cal.data("colorpicker").color,e.data.cal.get(0)),n(document).unbind("mouseup",l),n(document).unbind("mousemove",c),!1},d=function(e){return i.apply(e.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,e.pageY-e.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,e.pageX-e.data.pos.left))/150,10)).get(0),[e.data.preview]),!1},s=function(e){return x(e.data.cal.data("colorpicker").color,e.data.cal.get(0)),y(e.data.cal.data("colorpicker").color,e.data.cal.get(0)),n(document).unbind("mouseup",s),n(document).unbind("mousemove",d),!1},p=function(e){o(e.data.cal.get(0),e.target,e.data.cal.get(0))||(0!=e.data.cal.data("colorpicker").onHide.apply(this,[e.data.cal.get(0)])&&e.data.cal.hide(),n(document).unbind("mousedown",p))},o=function(e,o,t){if(e==o)return!0;if(e.contains)return e.contains(o);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(o));for(var r=o.parentNode;r&&r!=t;){if(r==e)return!0;r=r.parentNode}return!1},u=function(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},h=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},f=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},v=function(e){var o=6-e.length;if(0<o){for(var t=[],r=0;r<o;r++)t.push("0");t.push(e),e=t.join("")}return e},m=function(e){return g((o=e,{r:(o=parseInt(-1<o.indexOf("#")?o.substring(1):o,16))>>16,g:(65280&o)>>8,b:255&o}));var o},g=function(e){var o={h:0,s:0,b:0},t=Math.min(e.r,e.g,e.b),r=Math.max(e.r,e.g,e.b),i=r-t;return o.b=r,o.s=0!=r?255*i/r:0,0!=o.s?e.r==r?o.h=(e.g-e.b)/i:e.g==r?o.h=2+(e.b-e.r)/i:o.h=4+(e.r-e.g)/i:o.h=-1,o.h*=60,o.h<0&&(o.h+=360),o.s*=100/255,o.b*=100/255,o},k=function(e){var o={},t=Math.round(e.h),r=Math.round(255*e.s/100),i=Math.round(255*e.b/100);if(0==r)o.r=o.g=o.b=i;else{var a=i,n=(255-r)*i/255,c=t%60*(a-n)/60;360==t&&(t=0),t<60?(o.r=a,o.b=n,o.g=n+c):t<120?(o.g=a,o.b=n,o.r=a-c):t<180?(o.g=a,o.r=n,o.b=n+c):t<240?(o.b=a,o.r=n,o.g=a-c):t<300?(o.b=a,o.g=n,o.r=n+c):t<360?(o.r=a,o.g=n,o.b=a-c):(o.r=0,o.g=0,o.b=0)}return{r:Math.round(o.r),g:Math.round(o.g),b:Math.round(o.b)}},b=function(e){return o=k(e),t=[o.r.toString(16),o.g.toString(16),o.b.toString(16)],n.each(t,function(e,o){1==o.length&&(t[e]="0"+o)}),t.join("");var o,t},{init:function(r){if("string"==typeof(r=n.extend({},e,r||{})).color)r.color=m(r.color);else if(null!=r.color.r&&null!=r.color.g&&null!=r.color.b)r.color=g(r.color);else{if(null==r.color.h||null==r.color.s||null==r.color.b)return this;r.color=h(r.color)}return this.each(function(){if(!n(this).data("colorpickerId")){var e=n.extend({},r);e.origColor=r.color;var o="collorpicker_"+parseInt(1e3*Math.random());n(this).data("colorpickerId",o);var t=n('<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>').attr("id",o);e.flat?t.appendTo(this).show():t.appendTo(document.body),e.fields=t.find("input").bind("keyup",P).bind("change",i).bind("blur",N).bind("focus",S),t.find("span").bind("mousedown",H).end().find(">div.colorpicker_current_color").bind("click",W),e.selector=t.find("div.colorpicker_color").bind("mousedown",z),e.selectorIndic=e.selector.find("div div"),e.el=this,e.hue=t.find("div.colorpicker_hue div"),t.find("div.colorpicker_hue").bind("mousedown",O),e.newColor=t.find("div.colorpicker_new_color"),e.currentColor=t.find("div.colorpicker_current_color"),t.data("colorpicker",e),t.find("div.colorpicker_submit").bind("mouseenter",Y).bind("mouseleave",E).bind("click",T),x(e.color,t.get(0)),w(e.color,t.get(0)),y(e.color,t.get(0)),M(e.color,t.get(0)),C(e.color,t.get(0)),I(e.color,t.get(0)),q(e.color,t.get(0)),e.flat?t.css({position:"relative",display:"block"}):n(this).bind(e.eventName,j)}})},showPicker:function(){return this.each(function(){n(this).data("colorpickerId")&&j.apply(this)})},hidePicker:function(){return this.each(function(){n(this).data("colorpickerId")&&n("#"+n(this).data("colorpickerId")).hide()})},setColor:function(o){if("string"==typeof o)o=m(o);else if(null!=o.r&&null!=o.g&&null!=o.b)o=g(o);else{if(null==o.h||null==o.s||null==o.b)return this;o=h(o)}return this.each(function(){if(n(this).data("colorpickerId")){var e=n("#"+n(this).data("colorpickerId"));e.data("colorpicker").color=o,e.data("colorpicker").origColor=o,x(o,e.get(0)),w(o,e.get(0)),y(o,e.get(0)),M(o,e.get(0)),C(o,e.get(0)),I(o,e.get(0)),q(o,e.get(0))}})}});function x(e,o){var t=k(e);n(o).data("colorpicker").fields.eq(1).val(t.r).end().eq(2).val(t.g).end().eq(3).val(t.b).end()}function w(e,o){n(o).data("colorpicker").fields.eq(4).val(e.h).end().eq(5).val(e.s).end().eq(6).val(e.b).end()}function y(e,o){n(o).data("colorpicker").fields.eq(0).val(b(e)).end()}function C(e,o){n(o).data("colorpicker").selector.css("backgroundColor","#"+b({h:e.h,s:100,b:100})),n(o).data("colorpicker").selectorIndic.css({left:parseInt(150*e.s/100,10),top:parseInt(150*(100-e.b)/100,10)})}function M(e,o){n(o).data("colorpicker").hue.css("top",parseInt(150-150*e.h/360,10))}function I(e,o){n(o).data("colorpicker").currentColor.css("backgroundColor","#"+b(e))}function q(e,o){n(o).data("colorpicker").newColor.css("backgroundColor","#"+b(e))}function P(e){var o=e.charCode||e.keyCode||-1;if(t<o&&o<=90||32==o)return!1;!0===n(this).parent().parent().data("colorpicker").livePreview&&i.apply(this)}function N(e){n(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus")}function S(){t=0<this.parentNode.className.indexOf("_hex")?70:65,n(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),n(this).parent().addClass("colorpicker_focus")}function H(e){var o=n(this).parent().find("input").focus(),t={el:n(this).parent().addClass("colorpicker_slider"),max:0<this.parentNode.className.indexOf("_hsb_h")?360:0<this.parentNode.className.indexOf("_hsb")?100:255,y:e.pageY,field:o,val:parseInt(o.val(),10),preview:n(this).parent().parent().data("colorpicker").livePreview};n(document).bind("mouseup",t,a),n(document).bind("mousemove",t,r)}function O(e){var o={cal:n(this).parent(),y:n(this).offset().top};o.preview=o.cal.data("colorpicker").livePreview,n(document).bind("mouseup",o,l),n(document).bind("mousemove",o,c)}function z(e){var o={cal:n(this).parent(),pos:n(this).offset()};o.preview=o.cal.data("colorpicker").livePreview,n(document).bind("mouseup",o,s),n(document).bind("mousemove",o,d)}function Y(e){n(this).addClass("colorpicker_focus")}function E(e){n(this).removeClass("colorpicker_focus")}function T(e){var o=n(this).parent(),t=o.data("colorpicker").color;o.data("colorpicker").origColor=t,I(t,o.get(0)),o.data("colorpicker").onSubmit(t,b(t),k(t),o.data("colorpicker").el)}function j(e){var o=n("#"+n(this).data("colorpickerId"));o.data("colorpicker").onBeforeShow.apply(this,[o.get(0)]);var t=n(this).offset(),r=u(),i=t.top+this.offsetHeight,a=t.left;return i+176>r.t+r.h&&(i-=this.offsetHeight+176),a+356>r.l+r.w&&(a-=356),o.css({left:a+"px",top:i+"px"}),0!=o.data("colorpicker").onShow.apply(this,[o.get(0)])&&o.show(),n(document).bind("mousedown",{cal:o},p),!1}function W(){var e=n(this).parent(),o=e.data("colorpicker").origColor;e.data("colorpicker").color=o,x(o,e.get(0)),y(o,e.get(0)),w(o,e.get(0)),C(o,e.get(0)),M(o,e.get(0)),q(o,e.get(0))}n.fn.extend({ColorPicker:_.init,ColorPickerHide:_.hidePicker,ColorPickerShow:_.showPicker,ColorPickerSetColor:_.setColor})}(jQuery);
