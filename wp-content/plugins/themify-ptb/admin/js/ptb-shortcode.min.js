(function(d,c,a,e){function f(l,m){var j=l.nextAll(),i=j.first(),g="",h=m,k=j.last();if(h==="="){if(!k.is(":visible")){return false}g=k.offset().left+k.width()-i.offset().left-parseFloat(i.css("padding-right"))-parseFloat(i.css("padding-left"));j.not(":first").hide();i.data("placeholder",i.prop("placeholder")).prop("placeholder","")}else{g=k.prev().width();setTimeout(function(){if(h!=="="){j.show();i.prop("placeholder",i.data("placeholder"))}},800)}i.width(g)}function b(k,j,i,l){var g={type:"container",layout:"flex",direction:"row",classes:"ptb_group_meta_items",items:[{type:"label",text:j.label,classes:"ptb_group_meta_label"}]};if(!j.hide_exist){g.items.push({classes:"ptb_meta_exist",name:"ptb_"+i+"_"+k+"_exist",type:"radio",tooltip:l.meta_exists_tooltip.replace("%s",j.label),values:1,onchange:function(o){var n=d(d(this)[0].$el).nextAll();if(this.value()){n.hide()}else{n.show()}}})}else{g.items[0].classes+=" ptb_meta_exist_empty"}if(j.hide){return g}var h={classes:"ptb_meta_items",name:j.name,hide:false,values:j.values?j.values:""};h=d.extend(true,h,j);if(j.type==="number"){h.type="textbox"}if(j.type==="multiselect"){h.type="container";g.classes+=" ptb_group_meta_multiselect";h.html='<select id="'+j.name+'_select" style="width:100%;" multiple="multiple">';for(var m in j.values){h.html+='<option value="'+j.values[m].value+'">'+j.values[m].text+"</option>"}h.html+="</select>"}else{if(j.type==="textbox"){g.items.push({classes:"ptb_meta_small_select",name:k+"_slike",type:"listbox",tooltip:l.meta_like_start_tooltip.replace("%s",j.label),values:[{text:"",value:""},{text:"%",value:"%"}]})}else{if(j.type==="number"){g.items.push({classes:"ptb_meta_small_select ptb_meta_number_sign",name:k+"_from_sign",type:"listbox",values:[{text:"=",value:"="},{text:">=",value:">="},{text:">",value:">"}],onselect:function(n){f(d(d(this)[0].$el),this.value())}},{classes:"ptb_meta_small_input ptb_meta_placeholder ptb_meta_number_from",name:j.name+"_from",type:"textbox",value:"From"},{classes:"ptb_meta_space",type:"textbox"})}}}if(j.type!=="number"){g.items.push(h)}else{if(j.type==="number"){g.items.push({classes:"ptb_meta_small_input ptb_meta_placeholder ptb_meta_number_to",name:j.name+"_to",type:"textbox",value:"To"},{classes:"ptb_meta_small_select",name:k+"_to_sign",type:"listbox",values:[{text:"<=",value:"<="},{text:"<",value:"<"}]})}}if(j.type==="textbox"){g.items.push({classes:"ptb_meta_small_select",name:k+"_elike",type:"listbox",tooltip:l.meta_like_end_tooltip.replace("%s",j.label),values:[{text:"",value:""},{text:"%",value:"%"}]})}return g}if(typeof ptb_shortcodes_button!=="undefined"&&ptb_shortcodes_button&&ptb_shortcodes_button.length>0){tinymce.PluginManager.add("ptb",function(l,i){var m=[],j=[];for(var h in ptb_shortcodes_button){if(typeof ptb_shortcodes_button[h]!=="object"){continue}var g={text:ptb_shortcodes_button[h].name,body:{type:ptb_shortcodes_button[h].type},onclick:function(n){var k=this.settings.body;d.ajax({url:$ptb_url,type:"POST",dataType:"json",data:{post_type:k.type},success:function(q){if(q){var v=[],p=q.data;for(var s in p){var y={classes:"ptb_group_data_item",name:s,values:p[s].values?p[s].values:""};y=d.extend(true,y,p[s]);v.push(y)}if(typeof q.tax!=="undefined"&&q.tax.data){if(typeof q.tax.title!=="undefined"){v.push({fixedWidt:true,html:'<div data-group="taxes" class="ptb_group_container">'+q.tax.title+"</div>",height:100,type:"container"})}var w=q.tax.data;for(var r in w){var t={classes:"ptb_group_taxes_item",label:w[r].label,name:w[r].name,fixedWidth:true,tooltip:w[r].tooltip,html:'<select id="'+w[r].name+'_select"  style="width:100%;" multiple="multiple">',type:w[r].type==="multiselect"?"container":w[r].type};if(w[r].type==="multiselect"){for(var z in w[r].values){t.html+='<option value="'+w[r].values[z].value+'">'+w[r].values[z].text+"</option>"}t.html+="</select>"}else{t=d.extend(true,t,w[r])}v.push(t)}}if(typeof q.field!=="undefined"&&q.field.data){var x={type:"container",layout:"flex",direction:"column",align:"left",spacing:15,items:[]};if(typeof q.field.title!=="undefined"){v.push({fixedWidth:true,html:'<div data-group="meta" class="ptb_group_container">'+q.field.title+"</div>",height:100,type:"container"})}var u=q.field.data;for(var s in u){j[u[s].name+(u[s].type==="number"?"_from":"")]={type:u[s].type,key:s,field:true};x.items.push(b(s,u[s],"field",q))}v.push(x)}if(typeof q.meta!=="undefined"&&q.meta.data){var o={type:"container",layout:"flex",direction:"column",align:"left",spacing:15,items:[]};if(typeof q.meta.title!=="undefined"){v.push({fixedWidth:true,html:'<div data-group="meta" class="ptb_group_container">'+q.meta.title+"</div>",height:100,type:"container"})}var A=q.meta.data;for(var s in A){j[A[s].name+(A[s].type==="number"?"_from":"")]={type:A[s].type,key:s,field:false};o.items.push(b(s,A[s],"meta",q))}v.push(o)}l.windowManager.open({id:"ptb_shortcode_dialog",body:v,title:q.title,onOpen:function(){var C=d("input.mce-ptb_meta_placeholder"),B=d(".mce-ptb_meta_number_sign");if(C.length>0){C.each(function(){d(this).prop("placeholder",d(this).val()).val("")})}if(B.length>0){B.each(function(){f(d(this),"=")})}},onsubmit:function(J){var E="",K=d.event.trigger("PTB.insert_shortcode",{shortcode:E,setting:k,data:J.data});if(K){E=K}else{E='[ptb type="'+k.type+'"';var L=[];for(var N in J.data){var H=j[N]&&j[N].field,D=j[N]?j[N].key:"",G=H?"ptb_field_":"ptb_meta_",M=!j[N]||(j[N]&&!J.data[G+D+"_exist"]);if(d("#"+N+"_select").length>0&&M){var I=d("#"+N+"_select").val();L[N]=I?I.join(", "):false}else{var C=J.data[N];if(typeof C==="string"){C=d.trim(C)}else{if(C===true){C=1}}if(j[N]){var B=true;if(j[N].type==="textbox"&&(!C||!M)){B=J.data[D+"_slike"]=J.data[D+"_elike"]=L[D+"_slike"]=L[D+"_elike"]=false}else{if(j[N].type==="number"){if(!d.isNumeric(C)||!M){B=J.data[D+"_from_sign"]=L[D+"_from_sign"]=false}else{C=parseFloat(C)}if(!M||!d.isNumeric(J.data[G+D+"_to"])||J.data[D+"_from_sign"]==="="){J.data[G+D+"_to"]=J.data[D+"_to_sign"]=L[G+D+"_to"]=L[D+"_to_sign"]=false;if(J.data[D+"_from_sign"]==="="){J.data[D+"_from_sign"]=L[D+"_from_sign"]=false}}else{J.data[G+D+"_to"]=parseFloat(J.data[G+D+"_to"])}}}if(B){L[N]=C}}else{if(C&&M){var F=N.indexOf("_children")!==-1?"_children":(N.indexOf("_operator")!==-1?"_operator":false);if(F){F=N.replace(F,"");if(d("#ptb_tax_"+F+"_select").length>0&&(!d("#ptb_tax_"+F+"_select").val()||C==="in")){continue}}L[N]=C}}}}for(var N in L){if(L[N]){E+=" "+N+'="'+L[N]+'"'}}E+="]"}l.insertContent(E)}})}}})},classes:ptb_shortcodes_button[h].classes};m.push(g)}l.addButton("ptb",{icon:"ptb-favicon",type:"menubutton",title:"PTB Shortcodes",menu:m});d(a).ready(function(){d(a).off("change",".mce-ptb_meta_number_from,.mce-ptb_meta_number_to").on("change",".mce-ptb_meta_number_from,.mce-ptb_meta_number_to",function(n){if(!d.isNumeric(d(this).val())){var k=parseFloat(d(this).val());if(isNaN(k)){k=""}d(this).val(k)}})})})}}(jQuery,window,document));