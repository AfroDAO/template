jQuery(document).ready(function(e){"use strict";function n(e){var n=tinyMCEPreInit.mceInit,t=Object.keys(n)[0],i=n[t],o=tinyMCEPreInit.qtInit,d=n[Object.keys(o)[0]];i.selector=e,i.body_class=i.body_class.replace(t,e),d.id=e,tinyMCE.init(i),tinyMCE.execCommand("mceRemoveEditor",!0,e),tinyMCE.execCommand("mceAddEditor",!0,e),quicktags(d),QTags._buttonsInit()}function t(n){return e('<span><i class="fa fa-'+n.text+'"></i>   '+n.text+"</span>")}function i(n,i){if(void 0!==e.fn.select2){var o;e.each(n,function(){o=e(this).hasClass("icon-select")?{templateResult:t,templateSelection:t,width:"100%"}:i?{width:"100%"}:{minimumResultsForSearch:10},e(this).select2(o)})}}var o=e(".endpoints-container");void 0!==e.fn.nestable&&o.nestable({expandBtnHTML:"",collapseBtnHTML:""}),e("form#plugin-fw-wc").on("submit",function(n){if(void 0!==e.fn.nestable){var t=e(".dd").nestable("serialize"),i=JSON.stringify(t);e("input.endpoints-order").val(i)}}),e(document).on("click",".open-options",function(){var n=e(this).closest(".endpoint");e(this).find("i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-up"),n.find(".endpoint-content").first().toggleClass("dd-nodrag"),n.find(".endpoint-options").first().slideToggle(),n.find(".wp-switch-editor.switch-html").click()}),e(document).on("click",".add_new_field",function(n){n.stopPropagation();var t=e(this),i=t.data("target"),o=t.html(),d=e(document).find(".new-field-form").clone();a(d,i,o),d.dialog("open")});var d=!1,a=function(n,t,i){n.dialog({title:i,modal:!0,width:500,resizable:!1,autoOpen:!1,buttons:[{text:"Save",click:function(){e(this).find(".loader").css("display","inline-block"),e(this).add_new_field_handler(t),e(document).one("yith_wcmap_field_added",function(){n.dialog("close")})}}],close:function(e,t){n.dialog("destroy"),n.remove()}})};e.fn.add_new_field_handler=function(t){var a=e(this),c=a.find("#yith-wcmap-new-field").val(),l=a.find(".error-msg");d&&d.abort(),d=e.ajax({url:ywcmap.ajaxurl,data:{target:t,field_name:c,action:ywcmap.action_add},dataType:"json",beforeSend:function(){},success:function(t){if(a.find(".loader").hide(),t.error||o.find('[data-id="'+t.field+'"]').length)l.html(t.error);else{var d=e(t.html);e(".endpoints-container > ol.endpoints > li.endpoint").last().after(d),i(d.find("select")),n(d.find("textarea").attr("id")),e(document).trigger("yith_wcmap_field_added")}}})},o.on("change",function(e,t){void 0!==t&&n(t.find("textarea").attr("id"))});var c=function(e,n){var t,i,o=n.closest(".endpoint"),d=o.find(".hide-show-check"),a="checkbox"==e?n:d.first(),c=o.find(".hide-show-trigger");i=!!(a.is(":checked")&&"checkbox"==e||!a.is(":checked")&&"link"==e),d.prop("checked",i),t=a.is(":checked")?ywcmap.hide_lbl:ywcmap.show_lbl,c.html(t)};e(document).on("change",".hide-show-check",function(){c("checkbox",e(this))}),e(document).on("click",".hide-show-trigger",function(){c("link",e(this))}),e(document).on("click",".remove-trigger",function(){var n=e(this),t=n.data("endpoint"),i=e("input.endpoint-to-remove");if(void 0===t||!i.length)return!1;if(1!=confirm(ywcmap.remove_alert))return!1;var o=n.closest(".dd-item"),d=o.find("ol.endpoints"),a=i.val(),c=a.length?a.split(","):[];if(c.push(t),i.val(c.join(",")),d.length){var l=d.find("li.dd-item");o.after(l)}o.remove()}),i(o.find("select"),!0),i(e("#yith_wcmap_panel_general").find("select"),!1)});